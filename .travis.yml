sudo: required

language: dart

services:
  - docker

dart:
  - stable

before_install:
  - sudo service docker restart ; sleep 10
  - docker pull spotify/kafka
  - docker run --name kafka -d -p 2181:2181 -p 9092:9092 spotify/kafka
  - docker ps -a
  - sleep 10
  - docker exec kafka bash -c '$KAFKA_HOME/bin/kafka-topics.sh --create --zookeeper=localhost:2181 --topic dartKafkaTest --partitions 1 --replication-factor 1'
  - docker exec kafka bash -c '$KAFKA_HOME/bin/kafka-topics.sh --list --zookeeper=localhost:2181'

script:
  - pub run test

after_script:
  - docker exec kafka bash -c '$KAFKA_HOME/bin/kafka-topics.sh --list --zookeeper=localhost:2181'
